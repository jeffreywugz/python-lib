<html>
  <head>
    <title>${path}</title>
    <link rel="stylesheet" type="text/css" href="fsh.css"/>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript">
        var path = getQueryArgs().path || '/tmp/scratch';
        document.title = 'fsh: ' + path;
        var rpc = new ComPyRpc();
        var globalJsTag = '#js:', localJsTag = '#ljs:';
        var _filter = function(line, content) [line];
        var handler = function(cmd) rpc.popen(cmd, dirname(path));
        var _jobSeqFilter = function(cmd) [1000, cmd.replace(/(make [^.]+)\.[^ ]+/, '$1.view')]

        function filter(line, content) {
            rpc.set(path, content);
            eval(filterLines(content, globalJsTag).join(';'));
            eval(filterLine(line, localJsTag));
            //return line.match(jsVarTag)? line.seqSub(jsVarTag, _seq_): [line]; 
            return _filter(line, content);
        }
        
        function initApp() {
            var fsh = fish(handler, $('fish'), filter, path);
            fsh('', rpc.get(path));
        }
    </script>
  </head>
  <body onload="initApp()">
    <div id="fish" class="dev">${fish}</div>
  </body>
</html>
