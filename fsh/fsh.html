<html>
  <head>
    <title>Fish</title>
    <link rel="stylesheet" type="text/css" href="fsh.css"/>
    <script type="application/javascript;version=1.8" src="core.js"></script>
    <script type="application/javascript;version=1.8" src="fsh.js"></script>
    <script type="application/javascript;version=1.8">
    var content = ''
    function safe_set(_content){
        try{
            if(content != _content){content=_content; set(content);}
        }catch(e){
            alert('failed set content!');
        }
    }
        
    var tasks = new FshTasksGenerator(['{__self__}'], '.*');
    function filter(line, content, caret){
        safe_set(content);
        let global = getBlock(content, 0, '####', '####');
        let local = getBlock(content, caret, '####', '####');
        eval(filterLines(global, '#js:').join(';'));
        eval(filterLines(local, '#js:').join(';'));
        return line? tasks.gen(line): [];
    }
        
    function popen_wrapper(cmd){
        bind($('ref'), {href:'popen?' + encodeQueryString({post:cmd}), innerHTML: 'Ref This Cmd Output'});
        return popen(cmd);
    }
    function initApp(){
        var panel = $('fish');
        rpc_init();
        var fsh = fish(popen_wrapper, panel, filter, 'Fsh');
        panel.insertBefore(bind($n('a'), {id:'ref'}), $s(panel, 'lish'));
        fsh('', get());
    }
    </script>
  </head>
  <body onload="initApp()">
    <div id="fish" class="dev">${fish}</div>
  </body>
</html>
